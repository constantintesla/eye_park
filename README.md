# Eye Park - Система анализа движения глаз

Система анализа видео для выявления симптомов неврологических расстройств (болезнь Паркинсона, инсульт, рассеянный склероз и др.) на основе анализа движения глаз, моргания и мимики вокруг глаз.

## Описание

Eye Park - это исследовательская система, которая анализирует видео записей лиц для выявления аномалий в движениях глаз, моргании и мимике. Система извлекает визуальные признаки и оценивает риск неврологических расстройств на основе научных исследований.

## Возможности

- ✅ Извлечение визуальных признаков движения глаз, моргания и мимики
- ✅ Оценка симптомов по шкале 0-3
- ✅ Расчет EMSI (Eye Movement Severity Index)
- ✅ Определение риска ПД (Low/Medium/High)
- ✅ Сохранение сырых данных (видео, ключевые точки, траектории)
- ✅ Веб-интерфейс для просмотра результатов
- ✅ Telegram бот для загрузки видео
- ✅ Экспорт результатов (CSV, JSON, HTML)
- ✅ Визуализация траекторий движения глаз и моргания
- ✅ Поддержка пересчета всех результатов

## Структура проекта

```
eye_park/
├── bot.py                 # Telegram бот для загрузки видео
├── api.py                 # API сервер с веб-интерфейсом
├── parkinson_eye_analyzer.py  # Основной анализатор движений глаз
├── feature_extractor.py   # Извлечение визуальных признаков
├── symptom_analyzer.py    # Анализ симптомов на основе признаков
├── video_processor.py     # Обработка и предобработка видео
├── start_bot.py          # Запуск бота
├── start_api.py          # Запуск API
├── index.html            # Главная страница веб-интерфейса
├── results.html          # Страница со списком всех результатов
├── visualization.html    # Страница визуализации параметров
├── requirements.txt      # Зависимости
├── results.json          # Хранилище результатов (создается автоматически)
├── results/              # Директория с сырыми данными каждого анализа
│   └── {result_id}/      # Папка для каждого анализа
│       ├── original.mp4  # Исходное видео
│       ├── landmarks_data.json  # Данные о ключевых точках лица
│       ├── eye_tracking_data.json  # Данные о движении глаз
│       └── blink_analysis.json  # Данные о моргании
├── docker-compose.yml    # Docker конфигурация
├── Dockerfile            # Docker образ
├── README.md             # Документация
└── .env.example          # Пример переменных окружения
```

## Установка

### Локальная установка

1. Клонируйте репозиторий:
```bash
git clone <repository-url>
cd eye_park
```

2. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

5. Заполните переменные окружения в `.env`:
```
TELEGRAM_BOT_TOKEN=your_bot_token
API_URL=http://localhost:5000
API_PORT=5000
FLASK_ENV=development
DEBUG=True
```

### Docker установка

1. Создайте файл `.env` с вашими настройками
2. Запустите через docker-compose:
```bash
docker-compose up -d
```

## Использование

### Запуск API сервера

```bash
python start_api.py
```

API будет доступен по адресу `http://localhost:5000`

### Запуск Telegram бота

```bash
python start_bot.py
```

### Использование через веб-интерфейс

1. Откройте браузер и перейдите на `http://localhost:5000`
2. Загрузите видео файл (MP4, AVI, MOV)
3. Дождитесь завершения анализа
4. Просмотрите результаты и визуализацию

### Использование через Telegram бота

1. Найдите бота в Telegram
2. Отправьте команду `/start`
3. Отправьте команду `/analyze`
4. Следуйте инструкциям и загрузите видео
5. Получите результаты анализа

## Инструкция для записи видео

Для получения точных результатов рекомендуется следовать следующим инструкциям:

1. Сядьте перед камерой на расстоянии 50-70 см
2. Убедитесь, что ваше лицо хорошо освещено
3. Смотрите прямо в камеру в течение 5 секунд
4. Медленно переводите взгляд влево, затем вправо, затем вверх, затем вниз
5. Следите глазами за воображаемым объектом, движущимся по кругу
6. Быстро переводите взгляд между двумя точками (влево-вправо) 5 раз
7. Моргните несколько раз естественным образом
8. Завершите запись

**Требования к видео:**
- Длительность: 30-60 секунд
- Формат: MP4, AVI, MOV
- Минимальное разрешение: 720p
- Минимальный FPS: 30

## API Эндпоинты

- `POST /api/analyze` - Анализ видео файла
- `GET /api/results` - Получение всех результатов
- `POST /api/results` - Сохранение результата
- `GET /api/results/<index>` - Получение конкретного результата
- `POST /api/recalculate-all` - Пересчет всех результатов
- `GET /api/visualization/<index>` - Данные для визуализации
- `GET /api/video/<index>` - Получение видео файла
- `GET /api/stats` - Статистика
- `GET /api/export/csv` - Экспорт в CSV
- `GET /api/export/json` - Экспорт в JSON
- `GET /api/export/html` - Экспорт в HTML

## Извлекаемые признаки

### Движение глаз:
- Скорость движения глаз
- Частота саккад
- Амплитуда саккад
- Соотношение плавного слежения
- Длительность фиксаций
- Стабильность фиксаций
- Вариация направления взгляда
- Диапазон горизонтальных/вертикальных движений

### Моргание:
- Частота моргания
- Длительность моргания
- Амплитуда закрытия глаза
- Интервал между морганиями
- Соотношение неполных морганий
- Скорость закрытия/открытия глаза

### Мимика:
- Диапазон движения бровей
- Опущение века (птоз)
- Активность окологлазных мышц
- Асимметрия между глазами
- Вариация выражения лица
- Диапазон расширения глаз
- Частота прищуривания

## EMSI (Eye Movement Severity Index)

EMSI рассчитывается по формуле:
```
EMSI = 0.15 × Saccade_Freq + 0.20 × Blink_Rate - 0.10 × Fixation_Stability - 0.25 × Asymmetry + 10.0
```

**Интерпретация:**
- **+2…+5**: Нормальные движения глаз
- **0…+2**: Легкие нарушения
- **-2…0**: Умеренные нарушения (PD 1-2)
- **<-2**: Тяжелые нарушения (PD 3-5)

## Научная основа

Система основана на следующих исследованиях:

- **Leigh & Zee 2015**: "The Neurology of Eye Movements" - нормальные значения саккад и фиксаций
- **Antoniades et al. 2013**: "Eye movement abnormalities in Parkinson's disease" - аномалии при ПД
- **Bologna et al. 2013**: "Blink rate and blink timing in Parkinson's disease" - моргание при ПД
- **Fasano et al. 2012**: "Facial hypomimia in Parkinson's disease" - гипомимия при ПД

## Важные замечания

⚠️ **ВАЖНО**: Данная система предназначена для исследовательских целей и не заменяет медицинскую диагностику. Результаты не должны использоваться для постановки диагноза без консультации с квалифицированным врачом.

## Требования

- Python 3.11+
- OpenCV
- MediaPipe
- NumPy
- SciPy
- scikit-learn
- Flask
- aiogram

## Лицензия

[Укажите лицензию]

## Авторы

[Укажите авторов]

## Поддержка

[Укажите контакты для поддержки]
