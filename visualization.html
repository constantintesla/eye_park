<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è - Eye Park</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 30px;
        }
        
        .header {
            margin-bottom: 30px;
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            display: inline-block;
            margin-right: 10px;
            transition: all 0.3s;
            background: #667eea;
            color: white;
        }
        
        .btn:hover {
            background: #5568d3;
        }
        
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .chart-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .chart-container h3 {
            margin-bottom: 15px;
            color: #333;
        }
        
        .video-container {
            margin-top: 30px;
            text-align: center;
        }
        
        .video-container video {
            max-width: 100%;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .info-panel {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .info-panel h3 {
            margin-bottom: 15px;
            color: #1976d2;
        }
        
        .info-panel p {
            margin-bottom: 10px;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞</h1>
            <a href="/" class="btn">–ù–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <a href="/results" class="btn">–í—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</a>
        </div>
        
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏...</p>
        </div>
        
        <div id="content" style="display: none;">
            <div class="info-panel" id="infoPanel">
                <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            
            <div class="charts-grid">
                <div class="chart-container" style="grid-column: 1 / -1;">
                    <h3>–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –≥–ª–∞–∑ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è)</h3>
                    <canvas id="eyeTrajectoryChart"></canvas>
                </div>
                
                <div class="chart-container" style="grid-column: 1 / -1;">
                    <h3>–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –≥–ª–∞–∑ (2D –≤–∏–¥ —Å–≤–µ—Ä—Ö—É)</h3>
                    <canvas id="eyeTrajectory2DChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>–í—ã—Å–æ—Ç–∞ –≥–ª–∞–∑ (–º–æ—Ä–≥–∞–Ω–∏–µ)</h3>
                    <canvas id="eyeHeightChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>–ß–∞—Å—Ç–æ—Ç–∞ –º–æ—Ä–≥–∞–Ω–∏—è</h3>
                    <canvas id="blinkRateChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>–î–≤–∏–∂–µ–Ω–∏—è –≥–ª–∞–∑ (—Å–∞–∫–∫–∞–¥—ã –∏ —Ñ–∏–∫—Å–∞—Ü–∏–∏)</h3>
                    <canvas id="saccadeChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∞—Ü–∏–π</h3>
                    <canvas id="fixationChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤</h3>
                    <canvas id="parametersChart"></canvas>
                </div>
                
                <div class="chart-container">
                    <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∏–º–∏–∫–∏</h3>
                    <canvas id="facialChart"></canvas>
                </div>
            </div>
            
            <div class="video-container">
                <h3>–ò—Å—Ö–æ–¥–Ω–æ–µ –≤–∏–¥–µ–æ</h3>
                <video id="videoPlayer" controls>
                    –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                </video>
            </div>
        </div>
    </div>
    
    <script>
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –∏–∑ URL
        const urlParams = new URLSearchParams(window.location.search);
        const pathParts = window.location.pathname.split('/');
        const index = pathParts[pathParts.length - 1] || urlParams.get('index') || 0;
        
        let charts = {};
        
        async function loadVisualizationData() {
            try {
                const response = await fetch(`/api/visualization/${index}`);
                const data = await response.json();
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ
                const resultResponse = await fetch(`/api/results/${index}`);
                const result = await resultResponse.json();
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
                displayInfo(result);
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤
                createCharts(data, result);
                
                // –ó–∞–≥—Ä—É–∑–∫–∞ –≤–∏–¥–µ–æ
                if (data.video_url) {
                    document.getElementById('videoPlayer').src = data.video_url;
                }
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
            } catch (error) {
                document.getElementById('loading').innerHTML = `
                    <p style="color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}</p>
                `;
            }
        }
        
        function displayInfo(result) {
            const infoPanel = document.getElementById('infoPanel');
            infoPanel.innerHTML = `
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ #${index}</h3>
                <p><strong>–§–∞–π–ª:</strong> ${result.filename}</p>
                <p><strong>–î–∞—Ç–∞:</strong> ${new Date(result.timestamp).toLocaleString('ru-RU')}</p>
                <p><strong>EMSI Score:</strong> ${result.emsi.emsi_score.toFixed(2)} (${result.emsi.emsi_range})</p>
                <p><strong>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞:</strong> ${result.risk_level} (${(result.risk_probability * 100).toFixed(1)}%)</p>
            `;
        }
        
        function createCharts(data, result) {
            const features = result.features;
            
            // –ì—Ä–∞—Ñ–∏–∫ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è –≥–ª–∞–∑ (–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä—è–¥—ã)
            if (data.eye_trajectory && data.eye_trajectory.time.length > 0) {
                const maxTime = Math.max(...data.eye_trajectory.time);
                const timeLabels = data.eye_trajectory.time.map(t => (t / maxTime * 100).toFixed(1) + '%');
                
                charts.trajectory = new Chart(document.getElementById('eyeTrajectoryChart'), {
                    type: 'line',
                    data: {
                        labels: timeLabels,
                        datasets: [{
                            label: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (X)',
                            data: data.eye_trajectory.x,
                            borderColor: 'rgb(102, 126, 234)',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.3,
                            fill: false
                        }, {
                            label: '–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (Y)',
                            data: data.eye_trajectory.y,
                            borderColor: 'rgb(118, 75, 162)',
                            backgroundColor: 'rgba(118, 75, 162, 0.1)',
                            tension: 0.3,
                            fill: false
                        }]
                    },
                    options: {
                        responsive: true,
                        interaction: {
                            intersect: false,
                            mode: 'index'
                        },
                        plugins: {
                            legend: {
                                display: true
                            },
                            title: {
                                display: true,
                                text: '–ü–æ–∑–∏—Ü–∏—è –≥–ª–∞–∑ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (–ø–∏–∫—Å–µ–ª–∏)'
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '–í—Ä–µ–º—è (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: '–ü–æ–∑–∏—Ü–∏—è (–ø–∏–∫—Å–µ–ª–∏)'
                                }
                            }
                        }
                    }
                });
                
                // –ì—Ä–∞—Ñ–∏–∫ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è –≥–ª–∞–∑ (2D –≤–∏–¥)
                charts.trajectory2D = new Chart(document.getElementById('eyeTrajectory2DChart'), {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: '–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –≥–ª–∞–∑',
                            data: data.eye_trajectory.x.map((x, i) => ({x: x, y: data.eye_trajectory.y[i]})),
                            borderColor: 'rgb(102, 126, 234)',
                            backgroundColor: 'rgba(102, 126, 234, 0.5)',
                            pointRadius: 2,
                            pointHoverRadius: 4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                display: true
                            },
                            title: {
                                display: true,
                                text: '–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –≥–ª–∞–∑ (X-Y –ø–ª–æ—Å–∫–æ—Å—Ç—å)'
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: '–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–ø–∏–∫—Å–µ–ª–∏)'
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: '–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è (–ø–∏–∫—Å–µ–ª–∏)'
                                },
                                reverse: true
                            }
                        }
                    }
                });
            } else {
                document.getElementById('eyeTrajectoryChart').parentElement.innerHTML = 
                    '<p>–î–∞–Ω–Ω—ã–µ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</p>';
            }
            
            // –ì—Ä–∞—Ñ–∏–∫ –≤—ã—Å–æ—Ç—ã –≥–ª–∞–∑ (–º–æ—Ä–≥–∞–Ω–∏–µ)
            if (data.blink_data && data.blink_data.eye_heights && data.blink_data.eye_heights.time.length > 0) {
                charts.eyeHeight = new Chart(document.getElementById('eyeHeightChart'), {
                    type: 'line',
                    data: {
                        labels: data.blink_data.eye_heights.time.map(t => t.toFixed(2)),
                        datasets: [{
                            label: '–õ–µ–≤—ã–π –≥–ª–∞–∑',
                            data: data.blink_data.eye_heights.left,
                            borderColor: 'rgb(76, 175, 80)',
                            backgroundColor: 'rgba(76, 175, 80, 0.1)',
                            tension: 0.3
                        }, {
                            label: '–ü—Ä–∞–≤—ã–π –≥–ª–∞–∑',
                            data: data.blink_data.eye_heights.right,
                            borderColor: 'rgb(244, 67, 54)',
                            backgroundColor: 'rgba(244, 67, 54, 0.1)',
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            title: {
                                display: true,
                                text: '–í—ã—Å–æ—Ç–∞ –≥–ª–∞–∑ –≤–æ –≤—Ä–µ–º–µ–Ω–∏ (–º–æ—Ä–≥–∞–Ω–∏—è)'
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: '–í—ã—Å–æ—Ç–∞ (–ø–∏–∫—Å–µ–ª–∏)'
                                }
                            }
                        }
                    }
                });
            }
            
            // –ì—Ä–∞—Ñ–∏–∫ —á–∞—Å—Ç–æ—Ç—ã –º–æ—Ä–≥–∞–Ω–∏—è
            const blinkRate = features.blink_rate || 0;
            const normalBlinkRate = 17.5; // –ù–æ—Ä–º–∞ 15-20
            charts.blink = new Chart(document.getElementById('blinkRateChart'), {
                type: 'bar',
                data: {
                    labels: ['–ß–∞—Å—Ç–æ—Ç–∞ –º–æ—Ä–≥–∞–Ω–∏—è'],
                    datasets: [{
                        label: '–ò–∑–º–µ—Ä–µ–Ω–æ (–º–æ—Ä–≥–∞–Ω–∏–π/–º–∏–Ω)',
                        data: [blinkRate],
                        backgroundColor: 'rgba(102, 126, 234, 0.6)',
                        borderColor: 'rgb(102, 126, 234)',
                        borderWidth: 2
                    }, {
                        label: '–ù–æ—Ä–º–∞ (15-20)',
                        data: [normalBlinkRate],
                        backgroundColor: 'rgba(76, 175, 80, 0.4)',
                        borderColor: 'rgb(76, 175, 80)',
                        borderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '–ß–∞—Å—Ç–æ—Ç–∞ –º–æ—Ä–≥–∞–Ω–∏—è'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '–ú–æ—Ä–≥–∞–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É'
                            }
                        }
                    }
                }
            });
            
            // –ì—Ä–∞—Ñ–∏–∫ –¥–≤–∏–∂–µ–Ω–∏–π –≥–ª–∞–∑ (—Å–∞–∫–∫–∞–¥—ã –∏ —Ñ–∏–∫—Å–∞—Ü–∏–∏)
            const saccadeFreq = features.saccade_frequency || 0;
            const normalSaccadeFreq = 3.0; // –ù–æ—Ä–º–∞ 2-4
            charts.saccade = new Chart(document.getElementById('saccadeChart'), {
                type: 'bar',
                data: {
                    labels: ['–ß–∞—Å—Ç–æ—Ç–∞ —Å–∞–∫–∫–∞–¥', '–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∞—Ü–∏–π'],
                    datasets: [{
                        label: '–ò–∑–º–µ—Ä–µ–Ω–æ',
                        data: [saccadeFreq, features.fixation_stability || 0],
                        backgroundColor: [
                            'rgba(118, 75, 162, 0.6)',
                            'rgba(255, 152, 0, 0.6)'
                        ],
                        borderColor: [
                            'rgb(118, 75, 162)',
                            'rgb(255, 152, 0)'
                        ],
                        borderWidth: 2
                    }, {
                        label: '–ù–æ—Ä–º–∞ (–¥–ª—è —Å–∞–∫–∫–∞–¥)',
                        data: [normalSaccadeFreq, null],
                        backgroundColor: 'rgba(76, 175, 80, 0.4)',
                        borderColor: 'rgb(76, 175, 80)',
                        borderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '–î–≤–∏–∂–µ–Ω–∏—è –≥–ª–∞–∑: —Å–∞–∫–∫–∞–¥—ã –∏ —Ñ–∏–∫—Å–∞—Ü–∏–∏'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '–ó–Ω–∞—á–µ–Ω–∏–µ'
                            }
                        }
                    }
                }
            });
            
            // –ì—Ä–∞—Ñ–∏–∫ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ —Ñ–∏–∫—Å–∞—Ü–∏–π
            const fixationStab = features.fixation_stability || 0;
            const normalFixationStab = 1.0; // –ù–æ—Ä–º–∞ <1.0
            charts.fixation = new Chart(document.getElementById('fixationChart'), {
                type: 'bar',
                data: {
                    labels: ['–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∞—Ü–∏–π'],
                    datasets: [{
                        label: '–ò–∑–º–µ—Ä–µ–Ω–æ (–≥—Ä–∞–¥—É—Å—ã)',
                        data: [fixationStab],
                        backgroundColor: 'rgba(255, 152, 0, 0.6)',
                        borderColor: 'rgb(255, 152, 0)',
                        borderWidth: 2
                    }, {
                        label: '–ù–æ—Ä–º–∞ (<1.0¬∞)',
                        data: [normalFixationStab],
                        backgroundColor: 'rgba(76, 175, 80, 0.4)',
                        borderColor: 'rgb(76, 175, 80)',
                        borderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∞—Ü–∏–π'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '–ì—Ä–∞–¥—É—Å—ã'
                            }
                        }
                    }
                }
            });
            
            // –ì—Ä–∞—Ñ–∏–∫ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            charts.parameters = new Chart(document.getElementById('parametersChart'), {
                type: 'radar',
                data: {
                    labels: [
                        '–ß–∞—Å—Ç–æ—Ç–∞ —Å–∞–∫–∫–∞–¥',
                        '–ß–∞—Å—Ç–æ—Ç–∞ –º–æ—Ä–≥–∞–Ω–∏—è (–Ω–æ—Ä–º.)',
                        '–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∞—Ü–∏–π (–Ω–æ—Ä–º.)',
                        '–ê—Å–∏–º–º–µ—Ç—Ä–∏—è (–Ω–æ—Ä–º.)'
                    ],
                    datasets: [{
                        label: '–ò–∑–º–µ—Ä–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ)',
                        data: [
                            Math.min(features.saccade_frequency || 0, 5) / 5 * 100,
                            Math.min(features.blink_rate || 0, 30) / 30 * 100,
                            Math.max(0, 100 - (features.fixation_stability || 0) * 20),
                            Math.max(0, 100 - (features.asymmetry_left_right || 0) * 500)
                        ],
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgb(102, 126, 234)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgb(102, 126, 234)'
                    }, {
                        label: '–ù–æ—Ä–º–∞ (100%)',
                        data: [100, 100, 100, 100],
                        backgroundColor: 'rgba(76, 175, 80, 0.1)',
                        borderColor: 'rgb(76, 175, 80)',
                        borderWidth: 1,
                        borderDash: [5, 5],
                        pointBackgroundColor: 'rgb(76, 175, 80)'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤'
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: '–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (%)'
                            }
                        }
                    }
                }
            });
            
            // –ì—Ä–∞—Ñ–∏–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –º–∏–º–∏–∫–∏
            charts.facial = new Chart(document.getElementById('facialChart'), {
                type: 'bar',
                data: {
                    labels: [
                        '–ê—Å–∏–º–º–µ—Ç—Ä–∏—è (%)',
                        '–ü—Ç–æ–∑ (–ø–∏–∫—Å.)',
                        '–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –º—ã—à—Ü',
                        '–î–≤–∏–∂–µ–Ω–∏–µ –±—Ä–æ–≤–µ–π'
                    ],
                    datasets: [{
                        label: '–ó–Ω–∞—á–µ–Ω–∏—è',
                        data: [
                            (features.asymmetry_left_right || 0) * 100,
                            features.eyelid_droop || 0,
                            (features.periorbital_muscle_activity || 0) * 100,
                            (features.eyebrow_movement_range || 0) * 1000
                        ],
                        backgroundColor: [
                            'rgba(244, 67, 54, 0.6)',
                            'rgba(255, 152, 0, 0.6)',
                            'rgba(156, 39, 176, 0.6)',
                            'rgba(0, 188, 212, 0.6)'
                        ],
                        borderColor: [
                            'rgb(244, 67, 54)',
                            'rgb(255, 152, 0)',
                            'rgb(156, 39, 176)',
                            'rgb(0, 188, 212)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: {
                            display: true,
                            text: '–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∏–º–∏–∫–∏'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: '–ó–Ω–∞—á–µ–Ω–∏–µ'
                            }
                        }
                    }
                }
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        loadVisualizationData();
    </script>
</body>
</html>
